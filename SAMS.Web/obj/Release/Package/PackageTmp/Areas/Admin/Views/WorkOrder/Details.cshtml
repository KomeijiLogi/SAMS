@using SAMS.WorkOrders
@using Abp.Web.Mvc.Extensions
@{
    ViewBag.Title = "工单详情";
    Layout = "~/Areas/Admin/Views/Layout/_Layout.cshtml";
    ViewBag.CurrentPageName = "WorkOrder";
  
}
@model SAMS.WorkOrders.Dtos.GetDetailOutput
@section Scripts
{
    <script type="text/javascript" src="~/Content/admin/scripts/selectAccessory.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            $("#desDown,#desUp").click(function () {
                $(this).parent().addClass("hidden").siblings().removeClass("hidden");
            });//工单描述展开收起
            initEditSide();//初始化工单侧栏
            $('[data-toggle="popover"]').popover({ html: true });//回单信息鼠标弹出

            if ($(".btn-group ul li").length == 0)//更多操作
            {
                $(".btn-group").addClass("hidden");
            }
        });

        //启动分配派工对话框
        function startDialog(title,height) {
            modalLoadding("#editDailog", title, height)
            $("#editDailog").modal();

        }

        //显示分配派工对话框
        function showDialog(data) {

            $("#editDailog .modal-content").html(data);//填充对话框
            initUniform();
            Metronic.initSlimScroll('.scroller');//滚动条
            $("#editForm").removeData("validator");//删除验证器
            $.validator.unobtrusive.parse("#editForm");//添加验证器

            //派工弹出层
            if ($("#select-staff")) {
                $("#select-staff").change(function () {
                    $("#nextHandlerID").val($(this).val());
                    $("#nextHandlerName").val($("#select-staff option:selected").text());

                });
            }
            //分配弹出层
            if ($("#serviceOrg")) {
                $("#serviceOrg").change(function () {
                    $("#nextHandlerID").val($(this).val());
                    $("#nextHandlerName").val($("#serviceOrg option:selected").text());
                });
            }
        }

        //编辑记录成功后的处理
        function editSucess(data) { if (data == "ok") { $("#editDailog").modal("hide"); growlAlert.success("操作成功"); window.location.reload(); } else if (data == "error") { growlAlert.danger("操作失败"); } else { growlAlert.info(data); } }

        //改变tab内容
        function changetab(id) {
            $("#content" + id).siblings().addClass("hidden");
            $("#content" + id).removeClass("hidden");
        }

        //初始化编辑区侧栏
        function initEditSide() {
            EditSideView();
            Metronic.addResizeHandler(function () {
                EditSideView();
            });

            function EditSideView() {
                if (Metronic.getViewPort().width <= 992) {
                    $(".esh-side-edit-wrap").css("height", "auto");
                } else {
                    var contentH = $(window).height() - $(".esh-detail-content").offset().top - parseInt($(".portlet.light .portlet-body").css("padding-bottom"));
                    if ($(".esh-detail-content").height() < contentH) {
                        $(".esh-side-edit-wrap").css("height", ($(window).height() - parseInt($(".esh-side-edit-wrap").offset().top)) + "px");
                    } else {
                        $(".esh-side-edit-wrap").css("height", ($(document).height() - parseInt($(".esh-side-edit-wrap").offset().top)) + "px");
                    }
                }

            }
        }

        //关闭
        function close(id) {
            botbox.confirm("提示", "您确认关闭工单吗?", function (result) {
                if (result) {
                    //调用action
                    showLoading();
                    $.ajax({
                        url: "/admin/workorder/close",
                        type: "POST",
                        data: { "id": id },
                        success: function (data) {
                            hideLoading();
                            editSucess(data);
                        },
                        error: function (data) { hideLoading(); showException(data); }
                    });
                }
            });
        }
        //归档
        function archive(id) {
            botbox.confirm("提示", "您确认归档吗?", function (result) {
                if (result) {
                    //调用action
                    showLoading();
                    $.ajax({
                        url: "/admin/workorder/archive",
                        type: "POST",
                        data: { "id": id },
                        success: function (data) {
                            hideLoading();
                            editSucess(data);
                        },
                        error: function (data) { hideLoading(); showException(data); }
                    });
                }
            });
        }

        //取消
        function cancel(id) {
            botbox.confirm("提示", "您确认取消工单吗?", function (result) {
                if (result) {
                    //调用action
                    showLoading();
                    $.ajax({
                        url: "/admin/workorder/cancel",
                        type: "POST",
                        data: { "id": id },
                        success: function (data) {
                            hideLoading();
                            editSucess(data);
                        },
                        error: function (data) { hideLoading(); showException(data); }
                    });
                }
            });
        }



        //启动选择对话框
        function startBigDailog(title) {
            modalLoadding("#editBigDailog", title, 450)
            $("#editBigDailog").modal();
        }
        //启动宽屏对话框
        function startLgDialog(title) {
            modalLoadding("#editLgDailog", title, 500)
            $("#editLgDailog").modal();
        }

        //显示宽屏对话框
        function showLgDialog(data) {
            $("#editLgDailog .modal-content").html(data);//填充对话框
            initUniform();
            initDataPicker();//设置时间控件
            Metronic.initSlimScroll('.scroller');//滚动条
            $("#editForm").removeData("validator");//删除验证器
            $.validator.unobtrusive.parse("#editForm");//添加验证器

            if ($("#filePortrait")) {
                initFileInput("/admin/workorder/uploadimg");
                fileImgLimit();
            }
        }

        //保存回单
        function report_save() {
            var isvalid = true;
            if (!$("#editForm").valid()) {
                isvalid = false;
            }
            if (isvalid) {
                process_save();
            }
            
        }

        //保存处理信息
        function process_save() {
            showPopLoading();
            //图片
            var ImgPaths = new Array();
            $("#filePortrait_ul li").each(function () { ImgPaths.push($(this).find("input[name=ImgPaths]").val()); });
            $.ajax({
                url: "/admin/workorder/ReportProcessSave",
                type: "POST",
                data: {
                    "Id": $("#Id").val(),
                    "CustomerPhone": $("#CustomerPhone").val(),
                    "CustomerLinkMan": $("#CustomerLinkMan").val(),
                    "SerialNo": $("#SerialNo").val(),
                    "Office": $("#Office").val(),
                    "OfficePerson": $("#OfficePerson").val(),
                    "OfficePosition": $("#OfficePosition").val(),
                    "OfficeTel": $("#OfficeTel").val(),
                    "OfficeMobile": $("#OfficeMobile").val(),
                    "ServiceTime": $("#ServiceTime").val(),
                    "Warrenty": $("#Warrenty").val(),
                    "GuaranteedState": $("#GuaranteedState").val(),
                    "Faultap": $("#Faultap").val(),
                    "Dealfa": $("#Dealfa").val(),
                    "TrafficUrban": $("#TrafficUrban").val(),
                    "TrafficLong": $("#TrafficLong").val(),
                    "HotelEx": $("#HotelEx").val(),
                    "Supply": $("#Supply").val(),
                    "OtherEx": $("#OtherEx").val(),
                    "Photos":ImgPaths

                },
                success: function (data) {
                    hidePopLoading();
                    if (data == "ok") {
                        window.location.reload();
                    }
                },
                error: function (data) {
                    hidePopLoading();
                    showException(data);
                }
            });
        }

        
        //改变回单tab
        function changepanel(id, li) {
            $("#panel_" + id).siblings().addClass("hidden");
            $("#panel_" + id).removeClass("hidden");
            $(li).parent().siblings().removeClass("active");
            $(li).parent().addClass("active");
        }

        //初始化fileinput
        function initFileInput(uploadUrl) {
            var control = $("#filePortrait");
            control.fileinput({
                language: 'zh',        //设置语言
                uploadUrl: uploadUrl,  //上传的地址
                dropZoneEnabled: false,//是否显示拖拽区域
                showPreview: false,     //是否显示预览
                uploadAsync: true,
                showUpload: false,     //是否显示上传按钮
                showCaption: false,    //是否显示标题
                showRemove: false,      //是否显示删除/清空按钮
                showCancel: false,     //是否显示取消文件上传按钮

                allowedPreviewTypes: ['image'],
                allowedFileExtensions: ['jpg', 'png'],//接收的文件后缀
                showClose: false,
                showUploadedThumbs: true,
                autoReplace: true,
                browseClass: "btn default", //按钮样式
                enctype: 'multipart/form-data',
                validateInitialCount: true,
                maxFileCount: 4, //表示允许同时上传的最大文件个数
                browseIcon: "<i class='fa fa-camera'></i>",
                maxFileSize: 2000
            }).on("filebatchselected", function (event, files) {
                $(control).parents(".btn-file").siblings(".kv-upload-progress").fadeIn(500);
                control.fileinput('upload');
            }).on("fileuploaded", function (event, data) {
                if (data.response) {
                    $("#ulimg li img").attr("src", "/upload/"+data.response);
                    $("#ulimg li").find("input[name=ImgPaths]").val(data.response);
                    $(control).parents(".btn-file").siblings(".kv-upload-progress").fadeOut(500);
                    $("#filePortrait_ul").append($("#ulimg").html());
                    fileImgLimit();
                };
            }).on('filepreupload', function (event, data, previewId, index) {
            });
        }

        //删除图片
        function delelteImgPaths(obj) {
            $(obj).parent().remove();
            fileImgLimit();
        }

        //现在图片上传个数
        function fileImgLimit() {
            if ($("#filePortrait_ul li").length >= 4) {
                $("#filePortrait_ul").parent().siblings().addClass("hidden");
            } else {
                $("#filePortrait_ul").parent().siblings().removeClass("hidden");
            }
        }
        //清空日期
        var blnfirst = true;//首次执行标识
        function clearDate(input) {
            if (blnfirst) {
                //为避免与onchangeDate事件的冲突
                return;
            }

            if (!$(input).val()) {
                //日期清空时，重新查询
                changeQueryCondition();
            }
        }
        //启动编辑工单对话框
        function startWorkOrderDialog(title) {
            modalLoadding("#editworkDailog", title, 460)
            $("#editworkDailog").modal();
        }

        //弹出编辑工单对话框
        function showWorkOrderDialog(data) {
            $("#editworkDailog .modal-content").html(data);//填充对话框
            WorkOrder.init();//初始化对话框

            var indexLi = 0;
            var scrHeight = 34;
            var timeout = 0;
            $("#popCustomer").keyup(function (e) {
                var self = this;
                clearTimeout(timeout);
                var keycode = e.keyCode;

                var totalLi = $(this).parent().find(".dropdown-menu li").length - 1;
                //排除键盘中不需要搜索数据的键值
                var array = new Array();
                array = [16, 17, 18, 19, 20, 27, 33, 35, 36, 37, 39, 34, 35, 36, 45, 91, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 145, 187, 189, 192, 219, 220, 221, 255];
                for (i = 0; i < array.length; i++) {
                    if (keycode == array[i]) { return false; break; }
                }

                //当触发回车键时
                if (keycode == 13) {
                    $(this).blur();
                    var curr = $(this).parent().find(".dropdown-menu li.active a");
                    curr.click();
                }

                //触发上键
                if (keycode == 38) {
                    indexLi--;
                    if (indexLi <= 0) {
                        indexLi = 0;
                    }
                }
                else if (keycode == 40) {
                    //触发下键
                    indexLi++;
                    if (indexLi >= totalLi) {
                        indexLi = totalLi;
                    }
                }

                var ulPar = $(this).parent().find(".dropdown-menu");
                //根据ul的高度计算当键盘上下键时是否需要滚动
                if (ulPar.length > 0) {
                    ulPar.find("li:eq(" + indexLi + ")").addClass("active").siblings().removeClass("active");
                }

                timeout = setTimeout(function () {
                    //当键盘为回车、上键和下键时不去请求数据
                    if (keycode != 38 && keycode != 40 && keycode != 13) {
                        var a = $(self).attr("data-bind")
                        searchCus("#" + a, '/admin/customer/getcustomersul');
                        $("#" + a).parent().attr("aria-expanded", "true").parent().addClass("open");
                        indexLi = 0;
                    }
                }, 500);

            }).change(function () {
                $("#popCustomer_hidden").attr("data-bind", $(this).val());
                var a = $("#popCustomer_hidden").val();
                var b = $(this).val();
                if (b != a) { $(this).val(a) }
            }).keydown(function (e) {
                if (e.keyCode == 38 || e.keyCode == 40) {
                    e.preventDefault && e.preventDefault();
                }
            })

        }

        //创建工单成功
        function editWorkOrderSucess(data) { if (data == "ok") { $("#editworkDailog").modal("hide"); growlAlert.success("编辑工单成功"); setTimeout('window.location.reload()', 1500); } else { growlAlert.danger("编辑工单失败。"); } }
    </script>

    <!-- END PAGE SELF SCRIPTS -->
}
<div class="row">
    <div class="col-md-12">
        <div class="portlet light">
            <div class="portlet-title">
                <div class="caption tile">
                    工单详情
                </div>
                <div class="pull-right input-group">
                    @Html.ActionLink("返回工单列表", "Index", null, new { @class = "btn btn-default" })
                    @if (Model.BillStatus.Equals(BillStatus.Save))
                    {
                        @Ajax.ActionLink("受理工单", "Accept", new { id = Model.Id },
                                    new AjaxOptions()
                                    {
                                        HttpMethod = "POST",
                                        OnFailure = "showException",
                                        OnSuccess = "editSucess"
                                    },
                                    new { @class = "btn btn-default" })
                    }
                    else if (Model.BillStatus.Equals(BillStatus.Accept))
                    {
                        @Ajax.ActionLink("工单派工", "Dispatch", new { id = Model.Id },
                            new AjaxOptions()
                            {
                                HttpMethod = "GET",
                                OnSuccess = "showDialog",
                                OnBegin = "startDialog('工单派工',240)",
                                OnFailure = "showException",
                            },
                               new { @class = "btn btn-default" })
                    }
                    else if (Model.BillStatus.Equals(BillStatus.Complete))
                    {
                        @Ajax.ActionLink("回访客户", "returnvisit", new { id = Model.Id },
                            new AjaxOptions()
                            {
                                HttpMethod = "GET",
                                OnSuccess = "showDialog",
                                OnBegin = "startDialog('回访',460)",
                                OnFailure = "showException",
                            },
                               new { @class = "btn btn-default" })

                    }
                    else if (Model.BillStatus.Equals(BillStatus.ReturnVisit))
                    {
                        <a class="btn btn-default" 
                           href="javascript:close('@Model.Id');">关闭工单</a>


                    }
                    else if (Model.BillStatus.Equals(BillStatus.Close))
                    {
                        <a class="btn btn-default"
                           href="javascript:archive('@Model.Id');">归档</a>


                    }
                    <div class="btn-group margin-left-5">
                        <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown" aria-expanded="false">
                            更多操作&nbsp;<i class="fa fa-angle-down"></i>
                        </button>
                        <ul class="dropdown-menu pull-right" role="menu">
                            <li>
                                @Ajax.ActionLink("编辑", "popedit", new { id = Model.Id },
                                    new AjaxOptions()
                                    {
                                        HttpMethod = "GET",
                                        OnSuccess = "showWorkOrderDialog",
                                        OnBegin = "startWorkOrderDialog('编辑工单')",

                                    },
                                    new { @class = "" })
                            </li>
                            @if (Model.BillStatus.Equals(BillStatus.Dispatch))
                            {
                                <li>
                                    @Ajax.ActionLink("重新指派", "Dispatch", new { id = Model.Id },
                                    new AjaxOptions()
                                    {
                                        HttpMethod = "GET",
                                        OnSuccess = "showDialog",
                                        OnBegin = "startDialog('工单派工',240)",

                                    },
                                    new { @class = "" })
                                </li>
                            }
                            @if (Model.BillStatus.Equals(BillStatus.Complete)
                 || Model.BillStatus.Equals(BillStatus.Dispatch))
                            {
                                <li>
                                    @Ajax.ActionLink("修改回单", "report", new { id = Model.Id },
                                    new AjaxOptions()
                                    {
                                        HttpMethod = "GET",
                                        OnSuccess = "showLgDialog",
                                        OnBegin = "startLgDialog('填写回单')",
                                        OnFailure = "showException"

                                    },
                                    new { @class = "" })

                                </li>
                            }

                            <li><a class="" href="javascript:cancel(@Model.Id );">取消工单</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="portlet-body">
                <div class="esh-side-edit-wrap">
                    <div class="esh-work-order-side">
                        <label class="font-lg esh-txtellipsis code"
                               title="工单编号：@Model.Id ">
                            <i class="fa fa-file-text font-lg"></i> 编号：@Model.Id
                        </label>
                        <div class="pull-right">

                            @if (Model.BillStatus.Equals(BillStatus.Save))
                            {
                                <span class="label label-newly">待受理</span>
                            }
                            else if (Model.BillStatus.Equals(BillStatus.Accept))
                            {
                                <span class="label label-warning">已受理</span>
                            }
                            else if (Model.BillStatus.Equals(BillStatus.Dispatch))
                            {
                                <span class="label label-primary">已派工</span>
                            }
                            else if (Model.BillStatus.Equals(BillStatus.Complete))
                            {
                                <span class="label label-dark">已完工</span>
                            }
                            else if (Model.BillStatus.Equals(BillStatus.Statment))
                            {
                                <span class="label label-info">已结算</span>
                            }
                            else if (Model.BillStatus.Equals(BillStatus.ReturnVisit))
                            {
                                <span class="label label-success">已回访</span>
                            }
                            else if (Model.BillStatus.Equals(BillStatus.Close))
                            {
                                <span class="label label-success">已关闭</span>
                            }
                            else if (Model.BillStatus.Equals(BillStatus.Cancel))
                            {
                                <span class="label label-default">已取消</span>
                            }
                        </div>
                    </div>
                    <div class="esh-work-order-side">
                        <ul class="esh-pub-ul">
                            <li><span>客户名称：</span>@Model.CustomerName</li>
                            <li><span>客户电话：</span>@Model.CustomerPhone</li>
                            <li><span>区域：</span>@Model.CustomerArea</li>
                            <li><span>地址：</span>@Model.Address</li>



                        </ul>
                    </div>
                    <div class="esh-work-order-side">
                        <ul class="esh-pub-ul">
                            <li><span>产品名称：</span>@Model.ProductName</li>
                            <li><span>产品型号：</span>@Model.ProductModel</li>
                        </ul>
                    </div>
                    <div class="esh-work-order-side">
                        <ul class="esh-pub-ul">
                            <li>
                                <span>工单类型：</span>
                                @if (Model.ServiceType.Equals(ServiceType.Install))
                                {
                                    @:安装
                                }
                                else if (Model.ServiceType.Equals(ServiceType.Repair))
                                {
                                    @:维修
                                }
                            </li>
                            <li class="clearfix">
                                <p class="">
                                    <span>服务描述：</span>
                                    @if (Model.Description != null && ((string)Model.Description).Length > 30)
                                    {
                                        ((string)Model.Description).Substring(0, 30);
                                        @:...
                                    }
                                    else
                                    {
                                        @Model.Description;
                                    }

                                    <a id="desDown" class="pull-right" href="javascript:;">展开<i class="fa fa-angle-double-down"></i></a>
                                </p>
                                <p class="hidden">
                                    <span>服务描述：</span>@Model.Description

                                    <a id="desUp" class="pull-right" href="javascript:;">收起<i class="fa fa-angle-double-up"></i></a>
                                </p>
                            </li>

                        </ul>
                    </div>
                    <div class="esh-work-order-side">
                        <ul class="esh-pub-ul esh-pub-last">
                            <li>
                                <span>优先级：</span>
                                @if (Model.Priority.Equals(PriorityEnum.General))
                                {
                                    @:一般
                                }
                                else if (Model.Priority.Equals(PriorityEnum.Emergency))
                                {
                                    @:紧急
                                }
                                else if (Model.Priority.Equals(PriorityEnum.VeryUrgent))
                                {
                                    @:非常紧急
                                }

                            </li>
                            <li><span>业务员：</span>@Model.SaleMan</li>
                            <li><span>业务员电话：</span>@Model.SaleManPhone</li>


                        </ul>
                    </div>
                    <div class="esh-work-order-side">
                        <ul class="esh-pub-ul esh-pub-last">

                            <li><span>销售组织：</span>@Model.SaleOrg</li>
                            <li><span>出库单号：</span>@Model.IssueBill</li>

                            <li><span>创建时间：</span>@Model.CreationTime.ToString("yyyy-MM-dd hh:mm:ss")</li>
                        </ul>
                    </div>
                </div>
                <div class="esh-detail-content">
                    <div class="esh-tabbable-individual tabbable-custom">
                        <ul class="nav nav-tabs">
                            <li class="active">
                                <a href="#" onclick="changetab('1')" data-toggle="tab" aria-expanded="true">处理过程</a>
                            </li>
                            <li class="">
                                <a href="#" onclick="changetab('5')" data-toggle="tab" aria-expanded="true">回单信息</a>
                            </li>
                            <li class="">
                                <a href="#" onclick="changetab('4')" data-toggle="tab" aria-expanded="true">差旅费用</a>

                            </li>
                            
                       
                            <li class="">
                                <a href="#" onclick="changetab('2')" data-toggle="tab" aria-expanded="false">
                                    客户评价
                                </a>
                            </li>
                        </ul>
                        <div class="tab-content">
                            <!--处理过程-->
                            <div class="table-scrollable clear-border" style="padding-left:7px" id="content1">
                                <table class="table esh-work-table">
                                    <thead>
                                        <tr>
                                            <th style="min-width:100px;" aria-data="">
                                                活动
                                            </th>
                                            <th style="min-width:250px;" aria-data="">
                                                活动描述
                                            </th>

                                            <th style="width:100px;">
                                                处理人员
                                            </th>
                                            <th style="min-width: 100px;">
                                                处理时间
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @foreach (var item in Model.Activities)
                                        {
                                            <tr>
                                                <td>
                                                    <span class="occlusion"></span>
                                                    <span>
                                                        <i class="fa fa-dot-circle-o"></i>
                                                        @item.Name
                                                    </span>
                                                </td>
                                                <td>@item.Log </td>
                                                <td>@item.OperaterName</td>
                                                <td>@item.CreationTime.ToString("yyyy-MM-dd hh:mm:ss")</td>
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                            <!--回单信息-->
                            <div class="panel hidden" style="padding-left:7px" id="content5">
                                
                                <div class="esh-settlement-item">
                                    <p>
                                        <span>基本信息</span>
                                    </p>
                                    <table class="table table-bordered  esh-eval-table" style="margin-top:0px;margin-bottom:10px">
                                        <tbody>
                                            <tr>
                                                <td class="title">处理人员</td>
                                                <td>@Model.AssignedPersonName</td>
                                                <td class="title">处理日期</td>
                                                <td>@(Model.ServiceTime.HasValue ? Model.ServiceTime.Value.ToString("yyyy-MM-dd"):"")</td>
                                            </tr>
                                            <tr>
                                                <td class="title">保修期至</td>
                                                <td>@(Model.Warrenty.HasValue ? Model.Warrenty.Value.ToString("yyyy-MM-dd"):"")</td>
                                                <td class="title">在保状态</td>
                                                <td>@((Model.GuaranteedState ? "保内" : "保外"))</td>
                                            </tr>
                                            <tr>
                                                <td class="title">设备序号</td>
                                                <td colspan="3">@Model.SerialNo</td>
                                                
                                            </tr>
                                            <tr>
                                                <td class="title">处理方案</td>
                                                <td colspan="3">@Model.Dealfa</td>
                                            </tr>
                                            <tr>
                                                <td class="title">处理图片</td>
                                                <td class="pro-img" colspan="3">
@foreach (var item in Model.Photos)
{
                                                    <a class="fancybox-button"
                                                        href="/upload/@item.FilePath" 
                                                       title="" data-rel="fancybox-button" target="_blank">
                                                        <img class="timeline-body-img " 
                                                             src="/upload/@item.FilePath" alt="">
                                                    </a>
}
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="esh-settlement-item">
                                    <p>
                                        <span>客户信息</span>
                                    </p>
                                    <table class="table table-bordered  esh-eval-table" style="margin-top:0px;margin-bottom:10px">
                                        <tbody>
                                            <tr>
                                                <td class="title">使用科室</td>
                                                <td>@Model.Office</td>
                                                <td class="title">科室联系人</td>
                                                <td>@Model.OfficePerson</td>
                                            </tr>
                                            <tr>
                                                <td class="title">联系人职务</td>
                                                <td>@Model.OfficePosition</td>
                                                <td class="title">联系人电话</td>
                                                <td>@Model.OfficeTel</td>
                                            </tr>
                                            <tr>
                                                <td class="title">联系人手机</td>
                                                <td colspan="3">@Model.OfficeMobile</td>

                                            </tr>
                                           
                                        </tbody>
                                    </table>
                                </div>
                                
                             </div>

                               
                                <!--客户评价-->
                                <div class="panel hidden" id="content2">
                                    @if (Model.ServiceEvalution == null)
                                    {
                                <div class="esh-nodataNote" style="height:240px">
                                    <div class="esh-nodata-tip">

                                        <i class="fa fa-file-text-o"></i>
                                        <div class="con">暂无客户评价数据</div>
                                    </div>
                                </div>
                                    }
                                    else
                                    {
                                <table class="table table-bordered esh-eval-table">
                                    <tbody>
                                        <tr>
                                            <td class="title">评价客户</td>
                                            <td>@Model.CustomerName</td>
                                        </tr>
                                        <tr>
                                            <td class="title">评价结果</td>
                                            <td>
                                                <div class="eval-rank-wrap">
                                                    <div class="review-stars esh-eval-stars">
                                                        <div class="stars-static"  style="display:none;">
                                                            @{ var rank = "rank" + Model.ServiceEvalution.Evaluation;}
                                                            <span class="sta-rank @rank"></span>
                                                        </div>
                                                    </div>
                                                </div>
                                                @if (Model.ServiceEvalution.Evaluation.Equals(EvaluationEnum.Exellent))
                                                        {
                                                        <Text>非常满意</Text>
                                                        }
                                                        else if (Model.ServiceEvalution.Evaluation.Equals(EvaluationEnum.Good))
                                                        {
                                                        <Text>满意</Text>
                                                        }
                                                        else if (Model.ServiceEvalution.Evaluation.Equals(EvaluationEnum.Normal))
                                                        {
                                                        <Text>一般</Text>
                                                        }
                                                        else if (Model.ServiceEvalution.Evaluation.Equals(EvaluationEnum.Worse))
                                                        {
                                                        <Text>不满意</Text>
                                                        }
                                                        else if (Model.ServiceEvalution.Evaluation.Equals(EvaluationEnum.Worst))
                                                        {
                                                        <Text>非常不满意</Text>
                                                        }
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="title">沟通摘要</td>
                                            <td>@Model.ServiceEvalution.ReturnVisitDesc</td>
                                        </tr>
                                        <tr>
                                            <td class="title">回访时间</td>
                                            <td>@Model.ServiceEvalution.CreationTime.ToLocalTime().ToString()</td>
                                        </tr>
                                    </tbody>
                                </table>
                                                                        }

                                </div>
                                <!--差旅费用-->
                                <div class="panel hidden" style="padding-left:7px" id="content4">
                                    <div class="esh-settlement-item">
                                       
                                        <table class="table table-bordered  esh-eval-table" style="margin-top:0px;margin-bottom:10px">
                                            <tbody>
                                                <tr>
                                                    <td class="title">市内交通费</td>
                                                    <td>@Model.TrafficUrban.ToString()</td>
                                                    <td class="title">长途交通费</td>
                                                    <td>@Model.TrafficLong.ToString()</td>
                                                </tr>
                                                <tr>
                                                    <td class="title">住宿费</td>
                                                    <td>@Model.HotelEx.ToString()</td>
                                                    <td class="title">补助</td>
                                                    <td>@Model.Supply.ToString()</td>
                                                </tr>
                                                <tr>
                                                    <td class="title">其他费用</td>
                                                    <td colspan="3">@Model.OtherEx.ToString()</td>

                                                </tr>

                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                            </div>
                        </div>
        </div>

    </div>
</div>
<input id="userId" name="userId" type="hidden" value="@Model.AssignedPersonId">
<input id="workOrderId" name="workOrderId" type="hidden" value="@Model.Id" />
<div class="modal fade" id="editDailog" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
        </div>
    </div>
</div>

    <div class="modal fade bs-modal-lg" id="editLgDailog" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">

            </div>
        </div>
    </div>


<div class="modal fade" id="editBigDailog" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog" style="width:780px">
        <div class="modal-content">

        </div>
    </div>
</div>

<div class="modal fade bs-modal-lg" id="editworkDailog" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">

        </div>
    </div>
</div>
    </div>


